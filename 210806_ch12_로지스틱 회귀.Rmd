---
title: "Chapter12. 로지스틱 회귀"
author: "Jeong-Eun Lee"
date: '2021 8 6 '
output: html_document
---
### 12.1 소개
+ 이 장에서는 반응변수가 질적 데이터인 상황을 다루는 방법론을 살펴볼 것이다.  
  1) 반응변수 -업무수행능력[잘함(1) 못함(0)] & 예측변수 - 시험에서의 점수
  2) 반응변수 - 암 발병 여부[암에 걸림(1) 걸리지 않음(0)] & 예측변수 - 나이, 성별, 흡연, 다이어트, 가족의 의료기록 등
  3) 반응변수 - 회사의 지불능력[지불능력 있음(1) 파산(0)] & 예측변수 - 회사와 관련된 다양한 금융 정보
      + 반응변수가 이항변수인 상황은 통계적 응용분야에서 일반적이며 광범위하게 발생하고 있음
      
### 12.3 로짓 모형
+ 로지스틱 반응함수 : 확률 $\pi$와 X 사이 관계를 S-형태의 곡선으로 나타내는 함수
  + 확률 $\pi$는 X값이 증가함에 따라 처음에는 서서히 증가하다가 급격히 증가하고, 마지막에는 값이 안정화되지만 1을 넘지는 않음
  + $\pi = Pr(Y = 1|X = x) = \frac {e^{\beta_0 + \beta_1x}} {1 + e^{\beta_0 + \beta_1x}}$
  + 프로빗 모형 : 로지스틱 분포의 분포함수로 모형화한 확률 모형을 정규곡선의 누적분포로 표현한 것
+ 로지스틱 회귀함수 : $\pi = Pr(Y = 1|X = x_1, ...,X_p = x_p) = \frac {e^{\beta_0 + \beta_1x_1 + \beta_2x_2 + ... + \beta_px_p}} {1 + e^{\beta_0 + \beta_1x_1 + \beta_2x_2 + ... + \beta_px_p}}$
  + 이는 모수 $\beta_0, \beta_1, ..., \beta_p$에 비선형
  + 로짓변형 : $\pi$를 가지고 직접 작업하는 대신에 $\pi$의 변환된 값(=오즈비)을 가지고 선형화
  + 오즈비 : $\pi$가 어떤 사건의 발생확률일 때, 비율 $\pi / (1 - \pi)$
    + $\frac {\pi} {1-\pi} = e^{\beta_0 + \beta_1x_1 + ... + \beta_px_p}$
    + 로짓 : 오즈비에 로그를 취한 것 -> 모수의 선형함수를 만들어 냄
      + $g(x_1, ..., x_p) = ln(\frac {\pi} {1-\pi}) = \beta_0 + \beta_1x_1 + ... + \beta_px_p$
      + $\pi$는 0과 1 사이의 값이지만 $ln(\pi/(1-\pi))$ 값의 범위는 $-\infty$에서 $\infty$이므로 로짓이 선형회귀적합에 더 적합함
+ 최대우도법 : 모수추정을 위한 폐형(closed form) 표현이 존재하지 않음
  + (위키백과 - 최대가능도 방법 / 최대우도법) : 어떤 확률변수에서 표집한 값들을 토대로 그 확률변수의 모수를 구하는 방법으로 어떤 모수가 주어졌을 때 원하는 값들이 나올 가능도를 최대로 만드는 모수를 선택하는 방법
  
### 12.4 사례 : 파산 확률의 추정
```{r}
setwd("C:/Users/X-Note/Desktop")
financial = read.table("Financial ratio.txt", header = T)
head(financial)
str(financial)
```
+ 변수 : 예측변수 - Y(범주형), 반응변수 - X1, X2, X3(수치형)
  + $X_1$ = 총보유수입 / 자산, $X_2$ = 총수입/ 총자산, $X_3$ = 총매출 / 총자산
  + Y = 0(2년 후 도산한 경우), Y = 1(그렇지 않은 경우)
  
```{r}
glm_fr = glm(Y ~ X1 + X2 + X3, data = financial, family = binomial)
summary(glm_fr)
exp(coef(glm_fr))
round(exp(confint.default(glm_fr)), digits = 2)
```
+ 적합된 로짓 : $\hat{g}(x_1, ..., x_p) = -10.1535 + 0.3312X_1 + 0.1809X_2 + 5.0875X_3$
  + 이는 로짓 $log(\pi / (1-\pi))$를 예측하는 모형
  + 회귀계수와 표준오차의 비는 선형회귀에서는 t분포이나 로지스틱 회귀에서는 정규분포(z)를 갖음
  + p-value로부터 관측개체의 로짓을 예측하기 위하여 개별적으로 유의한 변수가 없음
  + 오즈비 해석 : 다른 변수들이 상수로 고정되었을 때 특정 변수의 한 단위 변화에 따른 오즈비의 변화량
  + 신뢰구간 해석 
    1) 신뢰구간 1 포함하지 않음 : 해당 변수는 오즈비에 유의한 영향을 가짐
    2) 신뢰구간 1 아래 : 해당 변수는 오즈비를 유의하게 낮춤
    3) 신뢰구간 1 위 : 해당 변수는 오즈비를 유의하게 증가
    
### 연습문제 12.3 O-링 데이터
우주선 발사에 사용되는 로켓 추진기 안의 O-링(O-ring)은 폭발로부터 로켓을 보호하는 중요한 역할을 한다. O-링의 불량 확률은 온도와 관련이 있다고 한다. 각 우주선에는 6개의 O-링이 있다. 23번의 비행에서 얻어진 데이터가 표 1.11에 있으며 이 책의 웹사이트에서도 얻을 수 있다. 각 비행에 대해 손상된 O-링의 개수와 발사시 기온에 대한 것이다.  
(a) 기온과 O-링의 손상 확률을 로지스틱 회귀를 이용하여 모형화하고 계수를 해석하여라.
```{r}
Oring = read.table("Oring.txt", header = T)
head(Oring)
str(Oring)
```
+ 변수 : 예측변수 - Damaged(범주형), 반응변수 - Temp(수치형)

```{r}
glm_oring = glm(Damaged ~ Temp, data = Oring)
summary(glm_oring)
exp(coef(glm_oring))
```
+ 적합된 로짓 : $Damaged = 3.69841 - 0.04754\ Temp$
  + Temp에 대한 계수는 Temp가 한 단위 변화할 때 상대오즈는 $e^{-0.05} = 0.9512294$이 곱해지게 되어 약 5% 감소한다.
  
(b) 기온이 $75^{\circ}$(화씨)일 때 발사된 비행 18의 데이터는 문제가 있는 것으로 판단되어 제기되었다. 제거된 데이터에 대해 로지스틱 회귀모형을 적합하고 계수를 해석하여라. 
```{r}
glm_oring18 = glm(Damaged[-18] ~ Temp[-18], data = Oring)
summary(glm_oring18)
exp(coef(glm_oring18))
```
+ 18번 데이터를 제거한 후 적합된 로짓 : $Damaged = 4.30416 - 0.05750\ Temp$
  + Temp에 대한 계수는 Temp가 한 단위 변화할 때 상대오즈는 $e^{-0.06} = 0.9417645$이 곱해지게 되어 약 6% 감소한다.

(c) 적합된 모형으로부터, 기온이 $31^{\circ}$(화씨)일 때 발사 시 O-링의 손상 확률을 계산하여라. 이는 1986년 1월 20일 챌린저호의 발사에서 폭발 사고가 있던 바로 그 날의 예보된 기온이다.  
```{r}
exp(4.30 - 0.06 * 31) / {1 + exp(4.30 - 0.06 * 31)}
```
+ $\pi = \frac {e^{4.30 - 0.06 * 31}} {1 + e^{4.30 - 0.06 * 31}}$ = 0.9198271 
+ 따라서 기온이 $31^{\circ}$(화씨)일 때 발사 시 O-링의 손상 확률은 0.92이다.

(d) 어떤 날이 발사에 좋을지 조언해보아라.  
```{r}
exp(4.30 - 0.06 * 31) / {1 + exp(4.30 - 0.06 * 31)}
exp(4.30 - 0.06 * 78) / {1 + exp(4.30 - 0.06 * 78)}
```

기온이 낮을수록 O-링의 손상 확률이 증가한다. 예를 들자면 $31^{\circ}$(화씨)일 때는 손상확률이 0.92인 반면에 $78^{\circ}$(화씨)일 때는 손상확률이 0.41로 급격히 낮아진다. 따라서 상대적으로 기온이 높은 날 발사를 한다면 O-링의 손상 확률은 감소하여 로켓을 보호할 수 있을 것이다.